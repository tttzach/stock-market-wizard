{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 31,
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "from datetime import datetime\n",
    "\n",
    "fama_table = pd.read_csv('F-F_Research_Data_Factors_daily.csv')\n",
    "\n",
    "# Convert time column into index\n",
    "fama_table.index = [datetime.strptime(str(x), \"%Y%m%d\")\n",
    "                    for x in fama_table.iloc[:,0]]\n",
    "# Remove time column\n",
    "fama_table = fama_table.iloc[:,1:]\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 35,
   "metadata": {},
   "outputs": [],
   "source": [
    "fama = fama_table['2019']\n",
    "fama = fama.rename(columns = {'Mkt-RF':'MKT'})\n",
    "fama = fama.apply(lambda x: x/100)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 36,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>MKT</th>\n",
       "      <th>SMB</th>\n",
       "      <th>HML</th>\n",
       "      <th>RF</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>2019-01-02</th>\n",
       "      <td>0.0023</td>\n",
       "      <td>0.0057</td>\n",
       "      <td>0.0115</td>\n",
       "      <td>0.0001</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-01-03</th>\n",
       "      <td>-0.0245</td>\n",
       "      <td>0.0039</td>\n",
       "      <td>0.0122</td>\n",
       "      <td>0.0001</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-01-04</th>\n",
       "      <td>0.0355</td>\n",
       "      <td>0.0044</td>\n",
       "      <td>-0.0073</td>\n",
       "      <td>0.0001</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-01-07</th>\n",
       "      <td>0.0094</td>\n",
       "      <td>0.0094</td>\n",
       "      <td>-0.0066</td>\n",
       "      <td>0.0001</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2019-01-08</th>\n",
       "      <td>0.0101</td>\n",
       "      <td>0.0050</td>\n",
       "      <td>-0.0053</td>\n",
       "      <td>0.0001</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "               MKT     SMB     HML      RF\n",
       "2019-01-02  0.0023  0.0057  0.0115  0.0001\n",
       "2019-01-03 -0.0245  0.0039  0.0122  0.0001\n",
       "2019-01-04  0.0355  0.0044 -0.0073  0.0001\n",
       "2019-01-07  0.0094  0.0094 -0.0066  0.0001\n",
       "2019-01-08  0.0101  0.0050 -0.0053  0.0001"
      ]
     },
     "execution_count": 36,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "fama.head()"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 45,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>0</th>\n",
       "      <th>1</th>\n",
       "      <th>2</th>\n",
       "      <th>3</th>\n",
       "      <th>4</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>Period Ending</td>\n",
       "      <td>3/31/2019</td>\n",
       "      <td>3/31/2018</td>\n",
       "      <td>3/31/2017</td>\n",
       "      <td>3/31/2016</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>Current Assets</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>Cash And Cash Equivalents</td>\n",
       "      <td>115184</td>\n",
       "      <td>80521</td>\n",
       "      <td>75312</td>\n",
       "      <td>93829</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>Short Term Investments</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>Net Receivables</td>\n",
       "      <td>389576</td>\n",
       "      <td>362007</td>\n",
       "      <td>316717</td>\n",
       "      <td>294071</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>5</th>\n",
       "      <td>Inventory</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>6</th>\n",
       "      <td>Other Current Assets</td>\n",
       "      <td>-</td>\n",
       "      <td>7852</td>\n",
       "      <td>-</td>\n",
       "      <td>1787</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>7</th>\n",
       "      <td>Total Current Assets</td>\n",
       "      <td>560064</td>\n",
       "      <td>511191</td>\n",
       "      <td>440037</td>\n",
       "      <td>434185</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>8</th>\n",
       "      <td>Long Term Investments</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>9</th>\n",
       "      <td>Property Plant and Equipment</td>\n",
       "      <td>666629</td>\n",
       "      <td>582310</td>\n",
       "      <td>570706</td>\n",
       "      <td>569013</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>10</th>\n",
       "      <td>Goodwill</td>\n",
       "      <td>208522</td>\n",
       "      <td>207919</td>\n",
       "      <td>200721</td>\n",
       "      <td>207644</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>11</th>\n",
       "      <td>Intangible Assets</td>\n",
       "      <td>61440</td>\n",
       "      <td>66401</td>\n",
       "      <td>64446</td>\n",
       "      <td>59180</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>12</th>\n",
       "      <td>Accumulated Amortization</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>13</th>\n",
       "      <td>Other Assets</td>\n",
       "      <td>6234</td>\n",
       "      <td>8581</td>\n",
       "      <td>8855</td>\n",
       "      <td>8555</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>14</th>\n",
       "      <td>Deferred Long Term Asset Charges</td>\n",
       "      <td>6234</td>\n",
       "      <td>8581</td>\n",
       "      <td>8855</td>\n",
       "      <td>8555</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>15</th>\n",
       "      <td>Total Assets</td>\n",
       "      <td>1502889</td>\n",
       "      <td>1376402</td>\n",
       "      <td>1284765</td>\n",
       "      <td>1278577</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>16</th>\n",
       "      <td>Current Liabilities</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>17</th>\n",
       "      <td>Accounts Payable</td>\n",
       "      <td>314925</td>\n",
       "      <td>295000</td>\n",
       "      <td>261206</td>\n",
       "      <td>262640</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>18</th>\n",
       "      <td>Short/Current Long Term Debt</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>19</th>\n",
       "      <td>Other Current Liabilities</td>\n",
       "      <td>18868</td>\n",
       "      <td>12323</td>\n",
       "      <td>14121</td>\n",
       "      <td>4933</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>20</th>\n",
       "      <td>Total Current Liabilities</td>\n",
       "      <td>398875</td>\n",
       "      <td>362809</td>\n",
       "      <td>325982</td>\n",
       "      <td>314984</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>21</th>\n",
       "      <td>Long Term Debt</td>\n",
       "      <td>238653</td>\n",
       "      <td>270753</td>\n",
       "      <td>283029</td>\n",
       "      <td>352299</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>22</th>\n",
       "      <td>Other Liabilities</td>\n",
       "      <td>22288</td>\n",
       "      <td>25930</td>\n",
       "      <td>27679</td>\n",
       "      <td>26948</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>23</th>\n",
       "      <td>Deferred Long Term Liability Charges</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>24</th>\n",
       "      <td>Minority Interest</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>25</th>\n",
       "      <td>Negative Goodwill</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>26</th>\n",
       "      <td>Total Liabilities</td>\n",
       "      <td>664574</td>\n",
       "      <td>663999</td>\n",
       "      <td>639163</td>\n",
       "      <td>697504</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>27</th>\n",
       "      <td>Stockholders' Equity</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "      <td>NaN</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>28</th>\n",
       "      <td>Misc. Stocks Options Warrants</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>29</th>\n",
       "      <td>Redeemable Preferred Stock</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>30</th>\n",
       "      <td>Preferred Stock</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>31</th>\n",
       "      <td>Common Stock</td>\n",
       "      <td>85821</td>\n",
       "      <td>85821</td>\n",
       "      <td>85821</td>\n",
       "      <td>73912</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>32</th>\n",
       "      <td>Retained Earnings</td>\n",
       "      <td>673931</td>\n",
       "      <td>586211</td>\n",
       "      <td>521619</td>\n",
       "      <td>459477</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>33</th>\n",
       "      <td>Treasury Stock</td>\n",
       "      <td>78563</td>\n",
       "      <td>40371</td>\n",
       "      <td>38162</td>\n",
       "      <td>47684</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>34</th>\n",
       "      <td>Capital Surplus</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "      <td>-</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>35</th>\n",
       "      <td>Other Stockholder Equity</td>\n",
       "      <td>78563</td>\n",
       "      <td>40371</td>\n",
       "      <td>38162</td>\n",
       "      <td>47684</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>36</th>\n",
       "      <td>Total Stockholder Equity</td>\n",
       "      <td>838315</td>\n",
       "      <td>712403</td>\n",
       "      <td>645602</td>\n",
       "      <td>581073</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>37</th>\n",
       "      <td>Net Tangible Assets</td>\n",
       "      <td>568353</td>\n",
       "      <td>438083</td>\n",
       "      <td>380435</td>\n",
       "      <td>314249</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "</div>"
      ],
      "text/plain": [
       "                                       0          1          2          3  \\\n",
       "0                          Period Ending  3/31/2019  3/31/2018  3/31/2017   \n",
       "1                         Current Assets        NaN        NaN        NaN   \n",
       "2              Cash And Cash Equivalents     115184      80521      75312   \n",
       "3                 Short Term Investments          -          -          -   \n",
       "4                        Net Receivables     389576     362007     316717   \n",
       "5                              Inventory          -          -          -   \n",
       "6                   Other Current Assets          -       7852          -   \n",
       "7                   Total Current Assets     560064     511191     440037   \n",
       "8                  Long Term Investments          -          -          -   \n",
       "9           Property Plant and Equipment     666629     582310     570706   \n",
       "10                              Goodwill     208522     207919     200721   \n",
       "11                     Intangible Assets      61440      66401      64446   \n",
       "12              Accumulated Amortization          -          -          -   \n",
       "13                          Other Assets       6234       8581       8855   \n",
       "14      Deferred Long Term Asset Charges       6234       8581       8855   \n",
       "15                          Total Assets    1502889    1376402    1284765   \n",
       "16                   Current Liabilities        NaN        NaN        NaN   \n",
       "17                      Accounts Payable     314925     295000     261206   \n",
       "18          Short/Current Long Term Debt          -          -          -   \n",
       "19             Other Current Liabilities      18868      12323      14121   \n",
       "20             Total Current Liabilities     398875     362809     325982   \n",
       "21                        Long Term Debt     238653     270753     283029   \n",
       "22                     Other Liabilities      22288      25930      27679   \n",
       "23  Deferred Long Term Liability Charges          -          -          -   \n",
       "24                     Minority Interest          -          -          -   \n",
       "25                     Negative Goodwill          -          -          -   \n",
       "26                     Total Liabilities     664574     663999     639163   \n",
       "27                  Stockholders' Equity        NaN        NaN        NaN   \n",
       "28         Misc. Stocks Options Warrants          -          -          -   \n",
       "29            Redeemable Preferred Stock          -          -          -   \n",
       "30                       Preferred Stock          -          -          -   \n",
       "31                          Common Stock      85821      85821      85821   \n",
       "32                     Retained Earnings     673931     586211     521619   \n",
       "33                        Treasury Stock      78563      40371      38162   \n",
       "34                       Capital Surplus          -          -          -   \n",
       "35              Other Stockholder Equity      78563      40371      38162   \n",
       "36              Total Stockholder Equity     838315     712403     645602   \n",
       "37                   Net Tangible Assets     568353     438083     380435   \n",
       "\n",
       "            4  \n",
       "0   3/31/2016  \n",
       "1         NaN  \n",
       "2       93829  \n",
       "3           -  \n",
       "4      294071  \n",
       "5           -  \n",
       "6        1787  \n",
       "7      434185  \n",
       "8           -  \n",
       "9      569013  \n",
       "10     207644  \n",
       "11      59180  \n",
       "12          -  \n",
       "13       8555  \n",
       "14       8555  \n",
       "15    1278577  \n",
       "16        NaN  \n",
       "17     262640  \n",
       "18          -  \n",
       "19       4933  \n",
       "20     314984  \n",
       "21     352299  \n",
       "22      26948  \n",
       "23          -  \n",
       "24          -  \n",
       "25          -  \n",
       "26     697504  \n",
       "27        NaN  \n",
       "28          -  \n",
       "29          -  \n",
       "30          -  \n",
       "31      73912  \n",
       "32     459477  \n",
       "33      47684  \n",
       "34          -  \n",
       "35      47684  \n",
       "36     581073  \n",
       "37     314249  "
      ]
     },
     "execution_count": 45,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "import lxml\n",
    "from lxml import html\n",
    "import requests\n",
    "import numpy as np\n",
    "import pandas as pd\n",
    "\n",
    "symbol = 'MFT.NZ'\n",
    "\n",
    "url = 'https://finance.yahoo.com/quote/' + symbol + '/balance-sheet?p=' + symbol\n",
    "\n",
    "# Fetch the page that we're going to parse\n",
    "page = requests.get(url)\n",
    "\n",
    "# Parse the page with LXML, so that we can start doing some XPATH queries\n",
    "# to extract the data that we want\n",
    "tree = html.fromstring(page.content)\n",
    "\n",
    "# Using XPATH, fetch all table elements on the page\n",
    "table = tree.xpath('//table') \n",
    "\n",
    "# Ensure that there is only one table on the page; if there is more than\n",
    "# one table, then it's possible that Yahoo Finance has changed their page\n",
    "# structure. If this fails, please let me know which symbol you're trying\n",
    "# to scrape in the comments below\n",
    "assert len(table) == 1 \n",
    "\n",
    "# Now that we've got the table element, convert it back to a string,\n",
    "# so that it can be parsed by Pandas\n",
    "tstring = lxml.etree.tostring(table[0], method='html')\n",
    "\n",
    "# Read the HTML table into a Pandas DataFrame - read_html\n",
    "# is designed to read HTML tables into a list of dataframe objects,\n",
    "# one dataframe for each table.\n",
    "df = pd.read_html(tstring)[0]\n",
    "\n",
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.0"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 2
}
